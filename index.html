<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XUPERACEXFULL PLAYER</title>
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <style>
        body { background-color: #121212; color: white; font-family: sans-serif; margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: auto; text-align: center; }
        #main-player { width: 100%; border-radius: 8px; background: black; }
        .motor-warn { background: #ff9800; color: black; padding: 10px; margin: 10px 0; border-radius: 5px; font-weight: bold; display: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 20px; }
        .card { background: #1e1e1e; padding: 10px; border-radius: 8px; cursor: pointer; transition: 0.3s; }
        .card:hover { background: #333; transform: scale(1.05); }
        .card img { width: 100%; height: 80px; object-fit: contain; border-radius: 4px; }
        .card span { display: block; margin-top: 5px; font-size: 12px; height: 30px; overflow: hidden; }
        #search { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 5px; border: none; background: #222; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color: #ffc107;">XUPERACEXFULL <span style="font-weight: 100; color: white;">PLAYER</span></h2>
    
    <div id="motor-alert" class="motor-warn">
        ⚠️ RECUERDA ABRIR ACE SERVE LAUNCHER
    </div>

    <video id="main-player" class="video-js vjs-big-play-centered"></video>

    <input type="text" id="search" placeholder="Buscar canal..." onkeyup="filter()">

    <div id="channel-list" class="grid"></div>
</div>

<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script>
    const M3U_URL = 'https://ipfs.io/ipns/k2k4r8oqlcjxsritt5mczkcn4mmvcmymbqw7113fz2flkrerfwfps004/data/listas/lista_iptv.m3u';
    let channels = [];
    const player = videojs('main-player', { fluid: true, controls: true });

    // Inicializar lista
    fetch(M3U_URL).then(res => res.text()).then(data => {
        const lines = data.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].startsWith('#EXTINF')) {
                const name = lines[i].split(',')[1] || 'Canal';
                const logo = lines[i].match(/tvg-logo="(.*?)"/)?.[1] || '';
                const url = lines[i+1]?.trim();
                if (url) {
                    const id = url.includes('://') ? url.split('://')[1] : url;
                    channels.push({ name, logo, id });
                }
            }
        }
        render(channels);
    });

    function render(list) {
        document.getElementById('channel-list').innerHTML = list.map(c => `
            <div class="card" onclick="playChannel('${c.id}')">
                <img src="${c.logo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/716/716429.png'">
                <span>${c.name}</span>
            </div>
        `).join('');
    }

    function playChannel(id) {
        // La URL para ACE SERVE Launcher
        const streamUrl = `http://127.0.0.1:6878/ace/getstream?id=${id}&format=mp4`;
        const alertBox = document.getElementById('motor-alert');
        
        alertBox.style.display = 'none';
        player.pause();
        
        // Cargar fuente
        player.src({ type: 'video/mp4', src: streamUrl });

        // Intentar reproducir y capturar bloqueo de seguridad
        setTimeout(() => {
            player.play().catch(error => {
                console.error("Bloqueo de navegador:", error);
                alertBox.innerHTML = "⚠️ BLOQUEO DE SEGURIDAD: Toca el candado > Ajustes del sitio > Contenido no seguro > PERMITIR.";
                alertBox.style.display = 'block';
            });
        }, 600);

        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function filter() {
        const q = document.getElementById('search').value.toLowerCase();
        render(channels.filter(c => c.name.toLowerCase().includes(q)));
    }
</script>

</body>
</html>

