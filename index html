<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XUPERACEXFULL</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffcc00">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/716/716429.png">

    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        :root { --accent: #ffcc00; --bg: #121214; --card: #1e1e21; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 20px; }
        .header { background: #000; padding: 15px; text-align: center; border-bottom: 2px solid var(--accent); position: sticky; top: 0; z-index: 100; }
        .header strong { color: var(--accent); }
        .video-container { width: 100%; background: #000; aspect-ratio: 16/9; position: sticky; top: 52px; z-index: 99; }
        .video-js { width: 100%; height: 100%; }
        .search-box { padding: 15px; }
        #search-bar { width: 100%; padding: 14px; border-radius: 10px; border: 1px solid #333; background: var(--card); color: white; font-size: 16px; box-sizing: border-box; }
        #channel-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; padding: 0 15px; }
        .channel-card { background: var(--card); padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; border: 1px solid #2a2a2a; transition: 0.2s; }
        .channel-card:active { transform: scale(0.95); border-color: var(--accent); }
        .channel-card img { height: 45px; margin-bottom: 8px; object-fit: contain; }
        .channel-card span { display: block; font-size: 12px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #motor-alert { display: none; background: #d97706; color: black; padding: 8px; text-align: center; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header"><strong>XUPERACEXFULL</strong> PLAYER</div>
<div id="motor-alert">‚ö†Ô∏è RECUERDA ABRIR ACE STREAM ENGINE</div>

<div class="video-container">
    <video id="main-player" class="video-js vjs-big-play-centered" controls preload="auto" playsinline></video>
</div>

<div class="search-box">
    <input type="text" id="search-bar" placeholder="üîç Buscar canal..." onkeyup="filterChannels()">
</div>

<div id="channel-list">Cargando lista...</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
    const M3U_URL = 'https://ipfs.io/ipns/k2k4r8oqlcjxsritt5mczkcn4mmvcmymbqw7113fz2flkrerfwfps004/data/listas/lista_iptv.m3u';
    let channels = [];
    const player = videojs('main-player', { fluid: true });

    async function init() {
        try {
            const res = await fetch(M3U_URL);
            const data = await res.text();
            parse(data);
        } catch (e) { document.getElementById('channel-list').innerHTML = "Error cargando lista."; }
    }

    function parse(text) {
        const lines = text.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].startsWith('#EXTINF')) {
                const name = lines[i].split(',')[1] || 'Canal';
                const logo = lines[i].match(/tvg-logo="(.*?)"/)?.[1] || '';
                const url = lines[i+1]?.trim();
                if (url) {
                    const id = url.includes('://') ? url.split('://')[1] : url;
                    channels.push({ name, logo, id });
                }
            }
        }
        render(channels);
    }

    function render(list) {
        const container = document.getElementById('channel-list');
        container.innerHTML = list.map(c => `
            <div class="channel-card" onclick="playChannel('${c.id}')">
                <img src="${c.logo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/716/716429.png'">
                <span>${c.name}</span>
            </div>
        `).join('');
    }

    function playChannel(id) {
        const streamUrl = `http://127.0.0.1:6878/ace/getstream?id=${id}&format=mp4&_timer=0`;
        document.getElementById('motor-alert').style.display = 'none';
        player.src({ src: streamUrl, type: 'video/mp4' });
        player.play().catch(() => { document.getElementById('motor-alert').style.display = 'block'; });
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function filterChannels() {
        const q = document.getElementById('search-bar').value.toLowerCase();
        render(channels.filter(c => c.name.toLowerCase().includes(q)));
    }

    init();
</script>
</body>
</html>
